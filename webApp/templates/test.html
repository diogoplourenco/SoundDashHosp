<!DOCTYPE html>
<html lang="pt-pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SoundDashHosp - Seletor de Sensores</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
  <style>
    body { background-color: #f5f8fa; color: #333; }
    header {
      background: linear-gradient(135deg, #2c3e50, #3498db);
      color: white;
      padding: 2rem 0;
      text-align: center;
    }
    .logo { font-size: 2.5rem; font-weight: 700; }
    .tagline { font-size: 1.2rem; opacity: 0.9; }
    .full-width-iframe { width: 100%; height: 300px; border: none; }
    footer {
      background-color: #2c3e50;
      color: white;
      padding: 2rem 0;
      text-align: center;
    }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <div class="logo">SoundDashHosp</div>
      <div class="tagline">Selecione Sensores e Parâmetros para Visualização</div>
    </div>
  </header>

  <div class="container my-5">
    <h2 class="mb-4">Filtros</h2>
    <div class="row">
      <div class="col-md-4">
        <h5>Sensores</h5>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="sensor1" value="sensor1"><label class="form-check-label" for="sensor1">Sensor 1</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="sensor2" value="sensor2"><label class="form-check-label" for="sensor2">Sensor 2</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" id="sensor3" value="sensor3"><label class="form-check-label" for="sensor3">Sensor 3</label></div>
      </div>

      <div class="col-md-4">
        <h5>Parâmetro</h5>
        <select id="parametro" class="form-select"multiple>
          <option value="LAEA">LAEA</option>
          <option value="LCpeak">LCpeak</option>
          <option value="LAFmax">LAFmax</option>
          <option value="LAFmin">LAFmin</option>
        </select>
      </div>

      <div class="col-md-4">
        <h5>Intervalo de Tempo</h5>
        <select id="intervalo" class="form-select mb-2">
          <option value="5m">Últimos 5 minutos</option>
          <option value="1h">Última hora</option>
          <option value="1d">Últimas 24 horas</option>
          <option value="7d">Últimos 7 dias</option>
        </select>
        <label for="from">De:</label>
        <input type="datetime-local" id="from" class="form-control mb-2" />
        <label for="to">Até:</label>
        <input type="datetime-local" id="to" class="form-control" />
      </div>
    </div>

    <div class="mt-4">
      <button class="btn btn-primary" onclick="carregarGrafico()">Atualizar Gráfico</button>
    </div>

    <div class="mt-5">
      <iframe id="grafico" class="full-width-iframe" src=""></iframe>
    </div>
  </div>

  <footer>
    <div class="container">&copy; 2025 SoundDashHosp. Todos os direitos reservados.</div>
  </footer>

  <script>
    function carregarGrafico() {
      const sensoresSelecionados = Array.from(document.querySelectorAll('input[type=checkbox]:checked'))
        .map(cb => cb.value);

      if (sensoresSelecionados.length === 0) {
        alert("Por favor, selecione pelo menos um sensor.");
        return;
      }

      const parametro = document.getElementById('parametro').value;
      const intervalo = document.getElementById('intervalo').value;
      const fromInput = document.getElementById('from').value;
      const toInput = document.getElementById('to').value;

      let from, to;

      if (fromInput && toInput) {
        from = new Date(fromInput).getTime();
        to = new Date(toInput).getTime();
      } else {
        from = `now-${intervalo}`;
        to = 'now';
      }

      const sensorQueryParams = sensoresSelecionados
        .map(sensor => `var-sensorName=${encodeURIComponent(sensor)}`)
        .join('&');

      const url = `http://localhost:3000/d-solo/aemh0e2wamy2od/dash1?orgId=1&theme=dark&from=${from}&to=${to}&var-param=${parametro}&${sensorQueryParams}&panelId=12`;

      document.getElementById('grafico').src = url;
    }
  </script>

</body>
</html>
